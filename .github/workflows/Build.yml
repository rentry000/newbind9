name: Build BIND9 9.21.17 for Android arm64 (NDK static, full features)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install host dependencies
        run: |
          sudo apt update -qq
          sudo apt install -yqq --no-install-recommends \
            build-essential pkg-config meson ninja-build wget unzip git autoconf libtool bison flex \
            python3-ply python3-jinja2 python3-setuptools ca-certificates gperf gengetopt autoconf automake autopoint libtool gettext gperf gengetopt pkg-config


      - name: Download Android NDK r26d
        run: |
          NDK_VERSION="r26d"
          NDK_ZIP="android-ndk-${NDK_VERSION}-linux.zip"
          wget -q https://dl.google.com/android/repository/${NDK_ZIP}
          unzip -q ${NDK_ZIP}
          mv android-ndk-${NDK_VERSION} /opt/ndk
          echo "ANDROID_NDK=/opt/ndk" >> $GITHUB_ENV
          echo "PATH=/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH" >> $GITHUB_ENV

      - name: Create gcc symlink for OpenSSL
        run: |
          mkdir -p /opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin
          ln -sf /opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang \
                 /opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android-gcc
          ln -sf /opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang++ \
                 /opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android-g++

      - name: Cross-compile OpenSSL 1.1.1w for Android arm64 (static)
        run: |
          git clone https://github.com/openssl/openssl.git
          cd openssl
          git checkout OpenSSL_1_1_1w

          export ANDROID_NDK_HOME=/opt/ndk
          export PATH=/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH
          export CC=aarch64-linux-android34-clang
          export CXX=aarch64-linux-android34-clang++
          export AR=llvm-ar
          export RANLIB=llvm-ranlib
          export STRIP=llvm-strip

          rm -rf fuzz
          ./Configure android-arm64 no-shared no-asm no-tests -static \
            --prefix=/opt/openssl-android \
            --openssldir=/opt/openssl-android/ssl \
            -D__ANDROID_API__=34

          mkdir -p fuzz
          touch fuzz/build.info

          # make -j$(nproc)
          # å…³é”®ï¼šç¡®ä¿ CFLAGS åŒ…å« -fPICï¼ˆandroid-arm64 é€šå¸¸å·²åŒ…å«ï¼Œä½†æ˜¾å¼åŠ æ›´å®‰å…¨ï¼‰
          make -j$(nproc) CFLAGS="-fPIC -O2"
          make install_sw install_ssldirs

      - name: Cross-compile libuv for Android arm64 (static)
        run: |
          set -e
          set -o pipefail
      
          echo "=== ä¸‹è½½å¹¶è¿›å…¥ libuv v1.48.0 ==="
          git clone https://github.com/libuv/libuv.git
          cd libuv
          git checkout v1.48.0
      
          echo "=== Debug: æ£€æŸ¥æ‰€æœ‰ random ç›¸å…³æ–‡ä»¶ï¼ˆå…³é”®ï¼ï¼‰==="
          ls -la src/unix/ 2>/dev/null | grep -E 'random' || echo "ã€æ³¨æ„ã€‘src/unix/ ä¸­æš‚æ—  random æ–‡ä»¶"
          find . -name "*random*.c" -type f | head -10
      
          echo "=== æ™ºèƒ½ Patchï¼šç¦ç”¨ Android getentropy è·¯å¾„ï¼ˆè§£å†³ undefined symbolï¼‰==="
          PATCH_COUNT=0
          for f in $(find . -name "*random*.c" -type f 2>/dev/null); do
            if grep -q "__ANDROID__" "$f" 2>/dev/null; then
              sed -i 's/defined(__ANDROID__) && __ANDROID_API__ >= 28/0 \/\/ patched for Android/g' "$f"
              echo "âœ… å·² patch: $f"
              PATCH_COUNT=$((PATCH_COUNT + 1))
            fi
          done
      
          if [ $PATCH_COUNT -eq 0 ]; then
            echo "âš ï¸ æœªæ‰¾åˆ° Android æ¡ä»¶ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡å…œåº•"
          else
            echo "ğŸ‰ å…± patch äº† $PATCH_COUNT ä¸ªæ–‡ä»¶"
          fi
      
          ./autogen.sh
      
          # æ ¸å¿ƒç¯å¢ƒå˜é‡ï¼ˆå¿…é¡»åœ¨ configure ä¹‹å‰ï¼‰
          export ac_cv_func_getentropy=no
          export ac_cv_func_getrandom=no
      
          echo "=== é…ç½® libuv ==="
          ./configure \
            --host=aarch64-linux-android \
            --prefix=/opt/libuv-android \
            CC=/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang \
            CXX=/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang++ \
            AR=llvm-ar \
            RANLIB=llvm-ranlib \
            STRIP=llvm-strip \
            --disable-shared --enable-static --with-pic \
            CFLAGS="--target=aarch64-linux-android34 -fPIC -O2 -D_FILE_OFFSET_BITS=64" \
            LDFLAGS="--target=aarch64-linux-android34"
      
          echo "=== ç¼–è¯‘å¹¶å®‰è£… ==="
          make -j$(nproc)
          make install
      
          echo "=== éªŒè¯ libuv ==="
          ls -lh /opt/libuv-android/lib/libuv.a
          file /opt/libuv-android/lib/libuv.a
      
      - name: Cross-compile liburcu for Android arm64 (static)
        run: |
          git clone https://git.liburcu.org/userspace-rcu.git
          cd userspace-rcu
          ./bootstrap
          ./configure \
            --host=aarch64-linux-android \
            --prefix=/opt/liburcu-android \
            CC=aarch64-linux-android34-clang \
            CXX=aarch64-linux-android34-clang++ \
            AR=llvm-ar \
            RANLIB=llvm-ranlib \
            STRIP=llvm-strip \
            --disable-shared --enable-static --with-pic
          make -j$(nproc)
          make install

      - name: Cross-compile libnghttp2 for Android arm64 (static)
        run: |
          git clone https://github.com/nghttp2/nghttp2.git
          cd nghttp2
          git checkout v1.62.1
          autoreconf -fi
          ./configure \
            --host=aarch64-linux-android \
            --prefix=/opt/libnghttp2-android \
            CC=aarch64-linux-android34-clang \
            CXX=aarch64-linux-android34-clang++ \
            AR=llvm-ar \
            RANLIB=llvm-ranlib \
            STRIP=llvm-strip \
            --disable-shared --enable-static --with-pic \
            --without-libxml2 --without-libexpat --without-libcares --without-jemalloc
          make -j$(nproc)
          make install
          
      - name: Cross-compile json-c with CMake (recommended way)
        run: |
          git clone https://github.com/json-c/json-c.git
          cd json-c

          mkdir build-android && cd build-android

          cmake .. \
          -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK_HOME/build/cmake/android.toolchain.cmake \
          -DANDROID_ABI=arm64-v8a \
          -DANDROID_PLATFORM=android-28 \
          -DANDROID_STL=none \
          -DBUILD_SHARED_LIBS=OFF \
          -DBUILD_STATIC_LIBS=ON \
          -DCMAKE_BUILD_TYPE=Release \
          -DCMAKE_INSTALL_PREFIX=/opt/json-c-android

          make -j$(nproc)
          make install

          ls -l /opt/json-c-android/lib/libjson-c.a

      - name: Cross-compile libxml2 for Android arm64 (static)
        run: |
          git clone https://gitlab.gnome.org/GNOME/libxml2.git
          cd libxml2
          git checkout v2.12.7
          ./autogen.sh \
            --host=aarch64-linux-android \
            --prefix=/opt/libxml2-android \
            CC=aarch64-linux-android34-clang \
            CXX=aarch64-linux-android34-clang++ \
            AR=llvm-ar \
            RANLIB=llvm-ranlib \
            STRIP=llvm-strip \
            --disable-shared --enable-static --with-pic \
            --without-python --without-lzma --without-zlib
          make -j$(nproc)
          make install

      - name: Cross-compile libcap for Android arm64 (static)
        run: |
          git clone https://git.kernel.org/pub/scm/libs/libcap/libcap.git
          cd libcap
          git checkout libcap-2.69

          # === å½»åº•æ¸…ç†æ‰€æœ‰ shared ç›¸å…³è§„åˆ™ï¼ˆé¿å… cap_magic.o / libcap.soï¼‰===
          sed -i '/libcap\.so/d' libcap/Makefile
          sed -i '/libpsx\.so/d' libcap/Makefile
          sed -i '/capso\.o/d' libcap/Makefile
          sed -i '/cap_magic\.o/d' libcap/Makefile
          sed -i '/loader\.txt/d' libcap/Makefile
          sed -i 's/ libcap\.so//g' libcap/Makefile
          sed -i 's/ libpsx\.so//g' libcap/Makefile

          # å…³é”®å˜é‡ï¼šè®© Makefile å®Œå…¨è·³è¿‡å…±äº«åº“æ„å»º
          make -C libcap \
          CC=aarch64-linux-android34-clang \
          AR=llvm-ar \
          RANLIB=llvm-ranlib \
          STRIP=llvm-strip \
          BUILD_CC=gcc \
          prefix=/opt/libcap-android \
          lib=lib \
          SHARED=no \
          CFLAGS="-fPIC -O2 -Dlinux -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64" \
          -j$(nproc)

          # å•ç‹¬æ‰§è¡Œ installï¼ˆåªå®‰è£…é™æ€åº“ï¼‰
          make -C libcap \
          prefix=/opt/libcap-android \
          lib=lib \
          SHARED=no \
          install

          # éªŒè¯ç»“æœ
          echo "=== å®‰è£…ç»“æœ ==="
          ls -l /opt/libcap-android/lib/libcap.a
          ls -l /opt/libcap-android/include/sys/capability.h || true
          find /opt/libcap-android -name "*.a" | head -5
      - name: Cross-compile libidn2 for Android arm64 (static) - use release tarball
        run: |
         # ä¸‹è½½å®˜æ–¹ releaseï¼ˆå½“å‰æœ€æ–°æ˜¯ 2.3.8ï¼Œå»ºè®®å» https://ftp.gnu.org/gnu/libidn/ ç¡®è®¤æœ€æ–°ç‰ˆï¼‰
         wget https://ftp.gnu.org/gnu/libidn/libidn2-2.3.8.tar.gz
         tar -xzf libidn2-2.3.8.tar.gz
         cd libidn2-2.3.8

         # è®¾ç½® NDK PATHï¼ˆå‡è®¾ä½ çš„ NDK åœ¨ /opt/ndkï¼‰
         export PATH=/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH

         ./configure \
          --host=aarch64-linux-android \
          --prefix=/opt/libidn2-android \
          --disable-shared \
          --enable-static \
          --with-pic \
          CC=aarch64-linux-android34-clang \
          CXX=aarch64-linux-android34-clang++ \
          AR=llvm-ar \
          RANLIB=llvm-ranlib \
          STRIP=llvm-strip \
          CFLAGS="--target=aarch64-linux-android34 -fPIC -O2" \
          LDFLAGS="--target=aarch64-linux-android34" \
           --disable-tests --disable-doc  # åŠ é€Ÿ + é¿å…æ–‡æ¡£ä¾èµ–

          make -j$(nproc)
          make install

          # éªŒè¯
          ls -lh /opt/libidn2-android/lib/libidn2.a || echo "libidn2.a missing!"
      - name: Cross-compile libmaxminddb for Android arm64 (static)
        run: |
         # ä¸‹è½½ release tarball
         wget https://github.com/maxmind/libmaxminddb/releases/download/1.12.2/libmaxminddb-1.12.2.tar.gz
         tar -xzf libmaxminddb-1.12.2.tar.gz
         cd libmaxminddb-1.12.2

         # === æ­¥éª¤1: å¼ºåˆ¶åˆ é™¤æ—§çš„ config.sub / config.guessï¼ˆé˜²æ®‹ç•™ï¼‰===
         rm -f config.sub config.guess || true

         # === æ­¥éª¤2: ä¸‹è½½ GNU æœ€æ–°ç‰ˆï¼ˆ2024+ æ”¯æŒ aarch64-linux-androidï¼‰===
         curl -L -o config.sub 'https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD'
         curl -L -o config.guess 'https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD'

         # === æ­¥éª¤3: å¼ºåˆ¶ +x æƒé™ + dos2unix é˜²è¡Œç»“æŸç¬¦å‘ï¼ˆè™½ç„¶ tarball æ˜¯ unix æ ¼å¼ï¼Œä½†å¤šä¸€å±‚ä¿é™©ï¼‰===
         chmod +x config.sub config.guess
         sudo apt-get update -qq && sudo apt-get install -y dos2unix || true
         dos2unix config.sub config.guess || true

         # === æ­¥éª¤4: éªŒè¯æ–‡ä»¶å¯æ‰§è¡Œä¸” triplet æ”¯æŒ ===
         ls -l config.sub config.guess
         file config.sub config.guess
         ./config.sub --version || { echo "ERROR: config.sub cannot run even after fix!"; exit 1; }
         ./config.sub aarch64-linux-android || { echo "ERROR: triplet aarch64-linux-android not supported! Output:"; ./config.sub aarch64-linux-android; exit 1; }

         # è®¾ç½® NDK PATH
          export PATH=/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH

          # configureï¼šæ˜¾å¼ --build + --host + å…¶ä»–é˜²å‘é€‰é¡¹
          ./configure \
          --build=x86_64-pc-linux-gnu \
          --host=aarch64-linux-android \
          --prefix=/opt/libmaxminddb-android \
          --disable-shared \
          --enable-static \
          --with-pic \
          --disable-tests \
          CC=aarch64-linux-android34-clang \
          CXX=aarch64-linux-android34-clang++ \
          AR=llvm-ar \
          RANLIB=llvm-ranlib \
          STRIP=llvm-strip \
          CFLAGS="--target=aarch64-linux-android34 -fPIC -O2" \
          LDFLAGS="--target=aarch64-linux-android34"

          make -j$(nproc)
          make install

          # æœ€ç»ˆéªŒè¯ï¼ˆå¦‚æœè¿™é‡Œè¿‡ï¼Œå°±æˆåŠŸäº†ï¼‰
          echo "=== Build result ==="
          ls -lh /opt/libmaxminddb-android/lib/libmaxminddb.a || { echo "libmaxminddb.a NOT generated!"; exit 1; }
          file /opt/libmaxminddb-android/lib/libmaxminddb.a  # åº”æ˜¾ç¤º ELF 64-bit LSB archive, ARM aarch64
     
      
      - name: Download BIND 9.21.17 source
        run: |
          VERSION="9.21.17"
          SRC_FILE="bind-${VERSION}.tar.xz"
          URL="https://ftp.isc.org/isc/bind9/9.21.17/bind-9.21.17.tar.xz"
          wget -c "$URL"
          if [ ! -s "$SRC_FILE" ]; then echo "Download failed"; exit 1; fi
          tar xf "$SRC_FILE"
          mv "bind-${VERSION}" bind9-source

      - name: Cross-compile zlib for Android arm64 (static)
        run: |
          set -e
          set -o pipefail
      
          echo "=== Cloning and building zlib for Android ==="
          git clone https://github.com/madler/zlib.git
          cd zlib
      
          # è®¾ç½® Android NDK ç¼–è¯‘å™¨
          export CC=/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang
          export CFLAGS="--target=aarch64-linux-android34 -fPIC -O2"
      
          # é…ç½®ï¼ˆé™æ€åº“ï¼‰
          ./configure \
            --static \
            --prefix=/opt/zlib-android
      
          # ç¼–è¯‘å¹¶å®‰è£…
          make -j$(nproc)
          sudo make install
      
          # åˆ›å»º pkg-config æ–‡ä»¶
          sudo mkdir -p /opt/zlib-android/lib/pkgconfig
          cat <<EOF | sudo tee /opt/zlib-android/lib/pkgconfig/zlib.pc
          prefix=/opt/zlib-android
          exec_prefix=\${prefix}
          libdir=\${exec_prefix}/lib
          includedir=\${prefix}/include
      
          Name: zlib
          Description: zlib compression library
          Version: 1.3
          Libs: -L\${libdir} -lz
          Cflags: -I\${includedir}
          EOF
      
          # éªŒè¯
          echo "=== zlib installed at /opt/zlib-android ==="
          ls -l /opt/zlib-android/lib/
          pkg-config --libs zlib
      
      
      
      - name: Disable all tests to avoid linking libuv/OpenSSL in shared library
        working-directory: bind9-source
        run: |
          echo "=== Disabling tests completely ==="
          if [ -f tests/meson.build ]; then
            echo "libtest_dep = declare_dependency()" > tests/meson.build
            echo "âœ… tests/meson.build replaced with empty stub."
          else
            echo "âš ï¸ Warning: tests/meson.build not found!"
          fi

      
      - name: Meson setup && Compile BIND
        working-directory: bind9-source
        env:
          PKG_CONFIG_PATH: /opt/zlib-android/lib/pkgconfig:/opt/openssl-android/lib/pkgconfig:/opt/libuv-android/lib/pkgconfig:/opt/liburcu-android/lib/pkgconfig:/opt/libnghttp2-android/lib/pkgconfig:/opt/json-c-android/lib/pkgconfig:/opt/libxml2-android/lib/pkgconfig:/opt/libcap-android/lib/pkgconfig:/opt/libidn2-android/lib/pkgconfig:/opt/libmaxminddb-android/lib/pkgconfig
        run: |
          set -e
          set -o pipefail
      
          echo "=== ç²¾ç¡® patch meson.buildï¼ˆåªæ³¨é‡Š fuzz å­ç›®å½•ï¼‰==="
      
          # ç”¨ heredoc åˆ›å»º patch è„šæœ¬ï¼Œé¿å…æ‰€æœ‰å¼•å·é—®é¢˜
          cat > /tmp/patch_meson.py <<'EOF'
          import re
          
          with open("meson.build", "r", encoding="utf-8") as f:
              content = f.read()
          
          # ç²¾ç¡®åŒ¹é… subdir("fuzz") æˆ– subdir('fuzz')ï¼Œä¸ç®¡å‰åç©ºæ ¼
          content = re.sub(
              r'^\s*subdir\s*\(\s*["\']fuzz["\']\s*\)',
              '# subdir("fuzz")  # patched for Android cross',
              content,
              flags=re.MULTILINE
          )
          
          with open("meson.build", "w", encoding="utf-8") as f:
              f.write(content)
          
          print("âœ… fuzz å­ç›®å½•å·²å®‰å…¨æ³¨é‡Š")
          EOF
          
              python3 /tmp/patch_meson.py
          
              echo "=== ç”Ÿæˆ cross-arm64.iniï¼ˆæœ€ç»ˆç‰ˆï¼‰==="
              cat > ../cross-arm64.ini <<'EOL'
          [binaries]
          c = '/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang'
          cpp = '/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang++'
          ar = '/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-ar'
          ranlib = '/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-ranlib'
          strip = '/opt/ndk/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-strip'
          pkg-config = 'pkg-config'
          
          [host_machine]
          system = 'android'
          cpu_family = 'aarch64'
          cpu = 'aarch64'
          endian = 'little'
          
          [built-in options]
          c_args = ['--target=aarch64-linux-android34', '-fPIC', '-O2', '-I/opt/openssl-android/include', '-I/opt/libuv-android/include', '-I/opt/liburcu-android/include', '-I/opt/libnghttp2-android/include', '-I/opt/json-c-android/include', '-I/opt/json-c-android/include/json-c', '-I/opt/libxml2-android/include/libxml2', '-I/opt/libcap-android/include', '-I/opt/libidn2-android/include', '-I/opt/libmaxminddb-android/include', '-Wno-error=implicit-function-declaration', '-Wno-error=implicit-int', '-Wno-error=strict-prototypes', '-Wno-error=missing-prototypes', '-Wno-error=deprecated-declarations', '-Wno-error=vla', '-Wno-error=parentheses', '-Wno-error=alloca', '-Wno-error=format-security', '-Wno-error=cpp', '-Wno-error=missing-field-initializers', '-Wno-error=pointer-arith', '-Wno-error=shadow', '-Wno-error=write-strings']
          cpp_args = ['--target=aarch64-linux-android34', '-fPIC', '-O2', '-I/opt/openssl-android/include', '-I/opt/libuv-android/include', '-I/opt/liburcu-android/include', '-I/opt/libnghttp2-android/include', '-I/opt/json-c-android/include', '-I/opt/json-c-android/include/json-c', '-I/opt/libxml2-android/include/libxml2', '-I/opt/libcap-android/include', '-I/opt/libidn2-android/include', '-I/opt/libmaxminddb-android/include', '-Wno-error=implicit-function-declaration', '-Wno-error=implicit-int', '-Wno-error=strict-prototypes', '-Wno-error=missing-prototypes', '-Wno-error=deprecated-declarations', '-Wno-error=vla', '-Wno-error=parentheses', '-Wno-error=alloca', '-Wno-error=format-security', '-Wno-error=cpp', '-Wno-error=missing-field-initializers', '-Wno-error=pointer-arith', '-Wno-error=shadow', '-Wno-error=write-strings']
          c_link_args = ['--target=aarch64-linux-android34', '-L/opt/openssl-android/lib', '-L/opt/libuv-android/lib', '-L/opt/liburcu-android/lib', '-L/opt/libnghttp2-android/lib', '-L/opt/json-c-android/lib', '-L/opt/libxml2-android/lib', '-L/opt/libcap-android/lib', '-L/opt/libidn2-android/lib', '-L/opt/libmaxminddb-android/lib', '-landroid']
          cpp_link_args = ['--target=aarch64-linux-android34', '-L/opt/openssl-android/lib', '-L/opt/libuv-android/lib', '-L/opt/liburcu-android/lib', '-L/opt/libnghttp2-android/lib', '-L/opt/json-c-android/lib', '-L/opt/libxml2-android/lib', '-L/opt/libcap-android/lib', '-L/opt/libidn2-android/lib', '-L/opt/libmaxminddb-android/lib', '-landroid']
          EOL
      
          echo "=== Meson setupï¼ˆæœ€ç²¾ç®€å‚æ•°ï¼‰==="
          meson setup ../build \
            --cross-file ../cross-arm64.ini \
            --prefix=/data/adb/bind9 \
            -Ddefault_library=static \
            -Doptimization=2 \
            --buildtype=release \
            2>&1 | tee ../meson-setup.log
      
          if [ ! -f ../build/build.ninja ]; then
            echo "âŒ Meson setup å¤±è´¥ï¼å®Œæ•´æ—¥å¿—ï¼š"
            cat ../build/meson-logs/meson-log.txt || true
            exit 1
          fi
      
          echo "=== Meson compile ==="
          meson compile -C ../build -v 2>&1 | tee ../meson-compile.log
      
          echo "=== DEBUG: build ç›®å½•çŠ¶æ€ ==="
          ls -la ../build/ || true
      
          echo "=== DEBUG: ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ ==="
          find ../build -type f -executable \( -name named -o -name dig -o -name host -o -name delv -o -name rndc -o -name named-checkconf -o -name named-checkzone \) 2>/dev/null || echo "No executables found"
      
                          
      - name: Collect & commit binaries
        run: |
          mkdir -p artifacts
          cp -v ../build/*/named ../build/*/dig ../build/*/host ../build/*/delv ../build/*/rndc ../build/*/named-checkconf ../build/*/named-checkzone artifacts/ 2>/dev/null || true
          ls -lh artifacts/ || echo "No binaries found"
          # ç„¶å git add/commit/push ...
